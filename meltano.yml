version: 1
send_anonymous_usage_stats: false
default_environment: dev
project_id: tap-suiteql
plugins:
  extractors:
  - name: tap-suiteql
    namespace: tap_suiteql
    pip_url: -e .
    capabilities:
    - properties
    - state
    - catalog
    - discover
    settings:
    - name: account_id
      env: TAP_SUITEQL_ACCOUNT_ID
    - name: consumer_key
      env: TAP_SUITEQL_CONSUMER_KEY
    - name: consumer_secret
      env: TAP_SUITEQL_CONSUMER_SECRET
    - name: token_id
      env: TAP_SUITEQL_TOKEN_ID
    - name: token_secret
      env: TAP_SUITEQL_TOKEN_SECRET
    - name: base_url
      env: TAP_SUITEQL_BASE_URL
    - name: start_date
      env: TAP_SUITEQL_START_DATE
    config:
      stream_maps:
    #     account:
    #       id: int(id)
    #       # _fivetran_deleted: "true if _sdc_deleted_at is not null else false"
    #       # __alias__: account
    #       # hash_id: md5(str(id))
    #       # __key_properties__: ["hash_id"]
    #     accounthierarchylevels:
    #       id: int(id)
    #     accountingbook:
    #       id: int(id)
    #     accountingperiod:
    #       accountingperiod: int(accountingperiod)
    #     accountingperiodfiscalcalendars:
    #       id: int(id)
    #     accounttype:
    #       internalid: int(internalid)
    #     automationsystems:
    #       id: int(id)
    #     classification:
    #       id: int(id)
    #     consolidatedexchangerate:
    #       id: int(id)
    #     contractitems:
    #       id: int(id)
    #     contracts:
    #       id: int(id)
    #     contractstatus:
    #       id: int(id)
    #     currency:
    #       id: int(id)
    #     customers:
    #       id: int(id)
    #     department:
    #       id: int(id)
    #     employees:
    #       id: int(id)
    #     entity:
    #       id: int(id)
    #     entityaddress:
    #       nkey: int(nkey)
    #       recordowner: int(recordowner)
    #     item:
    #       id: int(id)
    #     journalentries:
    #       id: int(id)
    #     location:
    #       id: int(id)
    #     locationmainaddress:
    #       nkey: int(nkey)
    #       recordowner: int(recordowner)
    #     productids:
    #       id: int(id)
    #     productstanding:
    #       id: int(id)
    #     productstatus:
    #       id: int(id)
    #     psms:
    #       id: int(id)
    #     subsidiary:
    #       id: int(id)
    #     transaction_lines:
    #       uniquekey: int(uniquekey)
        # transaction:
        #   id: int(id)
        # transactionaccountingline:
        #   account: int(account)
        #   accountingbook: int(accountingbook)
        #   amount: float(amount)
        #   amountlinked: float(amountlinked)
        #   #amountpaid: float(amountlinked)
        #   #amountunpaid: float(debit)+float(credit)
        #   #credit: float(credit)
        #   #debit: float(debit)
        #   exchangerate: float(exchangerate)
        #   #glauditnumbersequence: int(glauditnumbersequence)
        #   #glauditnumbersetby: int(glauditnumbersetby)
        #   netamount: float(netamount)
        #   #paymentamountunused: float(paymentamountunused)
        #   #paymentamountused: float(paymentamountused)
        #   transaction: int(transaction)
        #   transactionline: int(transactionline)
        transactionline:
          accountinglinetype: "str(config[accountinglinetype]) if accountinglinetype in config else null"
          actualshipdate: "config[actualshipdate] if actualshipdate in config else null"
          amortizationenddate: "config[amortizationenddate] if amortizationenddate in config else null"
          amortizationresidual: "str(config[amortizationresidual]) if amortizationresidual in config else null"
          amortizationsched: "int(config[amortizationsched]) if amortizationsched in config else null"
          amortizstartdate: "str(config[amortizstartdate]) if amortizstartdate in config else null"
          billeddate: "config[billeddate] if billeddate in config else null"
          billingschedule: "int(config[billingschedule]) if billingschedule in config else null"
          billvariancestatus: "str(config[billvariancestatus]) if billvariancestatus in config else null"
          category: "int(config[category]) if category in config else null"
          class: "int(config[class]) if class in config else null"
          cleared: "config[cleared] if cleared in config else null"
          cleareddate: "config[cleareddate] if cleareddate in config else null"
          closedate: "str(config[closedate]) if closedate in config else null"
          commitinventory: "int(config[commitinventory]) if commitinventory in config else null"
          commitmentfirm: "config[commitmentfirm] if commitmentfirm in config else null"
          costestimate: "float(config[costestimate]) if costestimate in config else null"
          costestimaterate: "float(config[costestimaterate]) if costestimaterate in config else null"
          costestimatetype: "str(config[costestimatetype]) if costestimatetype in config else null"
          createdfrom: "int(config[createdfrom]) if createdfrom in config else null"
          creditforeignamount: "float(config[creditforeignamount]) if creditforeignamount in config else null"
          cseg_conference: "int(config[cseg_conference]) if cseg_conference in config else null"
          custcol1: "config[custcol1] if custcol1 in config else null"
          custcol10: "int(config[custcol10]) if custcol10 in config else null"
          custcol11: "int(config[custcol11]) if custcol11 in config else null"
          custcol12: "int(config[custcol12]) if custcol12 in config else null"
          custcol13: "config[custcol13] if custcol13 in config else null"
          custcol14: "int(config[custcol14]) if custcol14 in config else null"
          custcol15: "int(config[custcol15]) if custcol15 in config else null"
          custcol16: "str(config[custcol16]) if custcol16 in config else null"
          custcol17: "float(config[custcol17]) if custcol17 in config else null"
          custcol18: "float(config[custcol18]) if custcol18 in config else null"
          custcol19: "float(config[custcol19]) if custcol19 in config else null"
          custcol2: "config[custcol2] if custcol2 in config else null"
          custcol20: "str(config[custcol20]) if custcol20 in config else null"
          custcol21: "str(config[custcol21]) if custcol21 in config else null"
          custcol22: "config[custcol22] if custcol22 in config else null"
          custcol23: "config[custcol23] if custcol23 in config else null"
          custcol24: "str(config[custcol24]) if custcol24 in config else null"
          custcol25: "int(config[custcol25]) if custcol25 in config else null"
          custcol26: "int(config[custcol26]) if custcol26 in config else null"
          custcol27: "int(config[custcol27]) if custcol27 in config else null"
          custcol28: "str(config[custcol28]) if custcol28 in config else null"
          custcol29: "str(config[custcol29]) if custcol29 in config else null"
          custcol3: "int(config[custcol3]) if custcol3 in config else null"
          custcol30: "int(config[custcol30]) if custcol30 in config else null"
          custcol32: "config[custcol32] if custcol32 in config else null"
          custcol33: "config[custcol33] if custcol33 in config else null"
          custcol34: "str(config[custcol34]) if custcol34 in config else null"
          custcol35: "float(config[custcol35]) if custcol35 in config else null"
          custcol4: "str(config[custcol4]) if custcol4 in config else null"
          custcol5: "int(config[custcol5]) if custcol5 in config else null"
          custcol6: "int(config[custcol6]) if custcol6 in config else null"
          custcol8: "int(config[custcol8]) if custcol8 in config else null"
          custcol9: "str(config[custcol9]) if custcol9 in config else null"
          custcol_5892_eutriangulation: "config[custcol_5892_eutriangulation] if custcol_5892_eutriangulation in config else null"
          custcol_adjustment_field: "str(config[custcol_adjustment_field]) if custcol_adjustment_field in config else null"
          custcol_adjustment_tax_code: "int(config[custcol_adjustment_tax_code]) if custcol_adjustment_tax_code in config else null"
          custcol_billqty: "float(config[custcol_billqty]) if custcol_billqty in config else null"
          custcol_celigo_hubspot_line_id: "str(config[custcol_celigo_hubspot_line_id]) if custcol_celigo_hubspot_line_id in config else null"
          custcol_classline: "int(config[custcol_classline]) if custcol_classline in config else null"
          custcol_counterparty_vat: "str(config[custcol_counterparty_vat]) if custcol_counterparty_vat in config else null"
          custcol_country_of_origin_code: "str(config[custcol_country_of_origin_code]) if custcol_country_of_origin_code in config else null"
          custcol_country_of_origin_name: "str(config[custcol_country_of_origin_name]) if custcol_country_of_origin_name in config else null"
          custcol_customer_type: "int(config[custcol_customer_type]) if custcol_customer_type in config else null"
          custcol_departmentline: "int(config[custcol_departmentline]) if custcol_departmentline in config else null"
          custcol_emirate: "int(config[custcol_emirate]) if custcol_emirate in config else null"
          custcol_establishment_code: "str(config[custcol_establishment_code]) if custcol_establishment_code in config else null"
          custcol_expense_code_of_supply: "int(config[custcol_expense_code_of_supply]) if custcol_expense_code_of_supply in config else null"
          custcol_expense_url: "str(config[custcol_expense_url]) if custcol_expense_url in config else null"
          custcol_from_ci_id: "str(config[custcol_from_ci_id]) if custcol_from_ci_id in config else null"
          custcol_inline_discount: "str(config[custcol_inline_discount]) if custcol_inline_discount in config else null"
          custcol_list_rate: "str(config[custcol_list_rate]) if custcol_list_rate in config else null"
          custcol_location: "str(config[custcol_location]) if custcol_location in config else null"
          custcol_mtce_support_percent: "str(config[custcol_mtce_support_percent]) if custcol_mtce_support_percent in config else null"
          custcol_mtce_support_type: "str(config[custcol_mtce_support_type]) if custcol_mtce_support_type in config else null"
          custcol_nature_of_transaction_codes: "str(config[custcol_nature_of_transaction_codes]) if custcol_nature_of_transaction_codes in config else null"
          custcol_nondeductible_account: "str(config[custcol_nondeductible_account]) if custcol_nondeductible_account in config else null"
          custcol_opt_out_ms: "config[custcol_opt_out_ms] if custcol_opt_out_ms in config else null"
          custcol_original_quantity: "str(config[custcol_original_quantity]) if custcol_original_quantity in config else null"
          custcol_renewal_reset_data: "str(config[custcol_renewal_reset_data]) if custcol_renewal_reset_data in config else null"
          custcol_renewals_exclusion: "config[custcol_renewals_exclusion] if custcol_renewals_exclusion in config else null"
          custcol_rsc_accthielevel: "int(config[custcol_rsc_accthielevel]) if custcol_rsc_accthielevel in config else null"
          custcol_rsc_prodid: "int(config[custcol_rsc_prodid]) if custcol_rsc_prodid in config else null"
          custcol_sii_annual_prorate: "float(config[custcol_sii_annual_prorate]) if custcol_sii_annual_prorate in config else null"
          custcol_sii_exempt_line_details: "int(config[custcol_sii_exempt_line_details]) if custcol_sii_exempt_line_details in config else null"
          custcol_sii_service_date: "config[custcol_sii_service_date] if custcol_sii_service_date in config else null"
          custcol_statistical_procedure_purc: "int(config[custcol_statistical_procedure_purc]) if custcol_statistical_procedure_purc in config else null"
          custcol_statistical_procedure_sale: "int(config[custcol_statistical_procedure_sale]) if custcol_statistical_procedure_sale in config else null"
          custcol_statistical_value: "float(config[custcol_statistical_value]) if custcol_statistical_value in config else null"
          custcol_statistical_value_base_curr: "float(config[custcol_statistical_value_base_curr]) if custcol_statistical_value_base_curr in config else null"
          custcol_suitesync_rev_rec_end: "config[custcol_suitesync_rev_rec_end] if custcol_suitesync_rev_rec_end in config else null"
          custcol_suitesync_rev_rec_start: "config[custcol_suitesync_rev_rec_start] if custcol_suitesync_rev_rec_start in config else null"
          custcol_swe_contract_end_date: "config[custcol_swe_contract_end_date] if custcol_swe_contract_end_date in config else null"
          custcol_swe_contract_item_term_months: "float(config[custcol_swe_contract_item_term_months]) if custcol_swe_contract_item_term_months in config else null"
          custcol_swe_contract_start_date: "config[custcol_swe_contract_start_date] if custcol_swe_contract_start_date in config else null"
          custcol_swe_ms_basis_amount: "float(config[custcol_swe_ms_basis_amount]) if custcol_swe_ms_basis_amount in config else null"
          custcol_swe_orig_list_rate: "float(config[custcol_swe_orig_list_rate]) if custcol_swe_orig_list_rate in config else null"
          custcol_swe_orig_price_level: "int(config[custcol_swe_orig_price_level]) if custcol_swe_orig_price_level in config else null"
          custcol_swe_price_level: "int(config[custcol_swe_price_level]) if custcol_swe_price_level in config else null"
          custcol_swv_ci_uplift: "float(config[custcol_swv_ci_uplift]) if custcol_swv_ci_uplift in config else null"
          custcol_swv_cr_ms_pricing_option: "int(config[custcol_swv_cr_ms_pricing_option]) if custcol_swv_cr_ms_pricing_option in config else null"
          custcol_termline: "int(config[custcol_termline]) if custcol_termline in config else null"
          custcol_vendor: "int(config[custcol_vendor]) if custcol_vendor in config else null"
          debitforeignamount: "float(config[debitforeignamount]) if debitforeignamount in config else null"
          department: "int(config[department]) if department in config else null"
          documentnumber: "str(config[documentnumber]) if documentnumber in config else null"
          donotdisplayline: "config[donotdisplayline] if donotdisplayline in config else null"
          eliminate: "config[eliminate] if eliminate in config else null"
          entity: "int(config[entity]) if entity in config else null"
          estgrossprofit: "float(config[estgrossprofit]) if estgrossprofit in config else null"
          estgrossprofitpercent: "float(config[estgrossprofitpercent]) if estgrossprofitpercent in config else null"
          estimatedamount: "float(config[estimatedamount]) if estimatedamount in config else null"
          expectedreceiptdate: "config[expectedreceiptdate] if expectedreceiptdate in config else null"
          expenseaccount: "int(config[expenseaccount]) if expenseaccount in config else null"
          foreignamount: "float(config[foreignamount]) if foreignamount in config else null"
          foreignamountpaid: "float(config[foreignamountpaid]) if foreignamountpaid in config else null"
          foreignamountunpaid: "float(config[foreignamountunpaid]) if foreignamountunpaid in config else null"
          foreignpaymentamountunused: "float(config[foreignpaymentamountunused]) if foreignpaymentamountunused in config else null"
          foreignpaymentamountused: "float(config[foreignpaymentamountused]) if foreignpaymentamountused in config else null"
          fulfillable: "config[fulfillable] if fulfillable in config else null"
          fxamountlinked: "float(config[fxamountlinked]) if fxamountlinked in config else null"
          fxvsoeprice: "float(config[fxvsoeprice]) if fxvsoeprice in config else null"
          id: "int(config[id]) if id in config else null"
          invsoebundle: "config[invsoebundle] if invsoebundle in config else null"
          isbillable: "config[isbillable] if isbillable in config else null"
          isclosed: "config[isclosed] if isclosed in config else null"
          iscogs: "config[iscogs] if iscogs in config else null"
          iscustomglline: "config[iscustomglline] if iscustomglline in config else null"
          isfullyshipped: "config[isfullyshipped] if isfullyshipped in config else null"
          isfxvariance: "config[isfxvariance] if isfxvariance in config else null"
          isinventoryaffecting: "config[isinventoryaffecting] if isinventoryaffecting in config else null"
          isrevrectransaction: "config[isrevrectransaction] if isrevrectransaction in config else null"
          item: "int(config[item]) if item in config else null"
          itemtype: "int(config[itemtype]) if itemtype in config else null"
          linelastmodifieddate: "config[linelastmodifieddate] if linelastmodifieddate in config else null"
          linesequencenumber: "int(config[linesequencenumber]) if linesequencenumber in config else null"
          location: "int(config[location]) if location in config else null"
          mainline: "config[mainline] if mainline in config else null"
          matchbilltoreceipt: "config[matchbilltoreceipt] if matchbilltoreceipt in config else null"
          memo: "str(config[memo]) if memo in config else null"
          needsrevenueelement: "config[needsrevenueelement] if needsrevenueelement in config else null"
          netamount: "float(config[netamount]) if netamount in config else null"
          oldcommitmentfirm: "config[oldcommitmentfirm] if oldcommitmentfirm in config else null"
          orderpriority: "float(config[orderpriority]) if orderpriority in config else null"
          paymentmethod: "int(config[paymentmethod]) if paymentmethod in config else null"
          price: "int(config[price]) if price in config else null"
          processedbyrevcommit: "config[processedbyrevcommit] if processedbyrevcommit in config else null"
          quantity: "float(config[quantity]) if quantity in config else null"
          quantitybackordered: "float(config[quantitybackordered]) if quantitybackordered in config else null"
          quantitybilled: "float(config[quantitybilled]) if quantitybilled in config else null"
          quantitycommitted: "float(config[quantitycommitted]) if quantitycommitted in config else null"
          quantityrejected: "float(config[quantityrejected]) if quantityrejected in config else null"
          quantityshiprecv: "float(config[quantityshiprecv]) if quantityshiprecv in config else null"
          rate: "float(config[rate]) if rate in config else null"
          rateamount: "float(config[rateamount]) if rateamount in config else null"
          ratepercent: "float(config[ratepercent]) if ratepercent in config else null"
          requestnote: "str(config[requestnote]) if requestnote in config else null"
          revenueelement: "int(config[revenueelement]) if revenueelement in config else null"
          subsidiary: "int(config[subsidiary]) if subsidiary in config else null"
          taxline: "config[taxline] if taxline in config else null"
          transaction: "int(config[transaction]) if transaction in config else null"
          transactiondiscount: "config[transactiondiscount] if transactiondiscount in config else null"
          transactionlinetype: "str(config[transactionlinetype]) if transactionlinetype in config else null"
          uniquekey: "int(config[uniquekey]) if uniquekey in config else null"
          units: "int(config[units]) if units in config else null"
          vsoedelivered: "config[vsoedelivered] if vsoedelivered in config else null"
          vsoeisestimate: "config[vsoeisestimate] if vsoeisestimate in config else null"
          vsoepermitdiscount: "str(config[vsoepermitdiscount]) if vsoepermitdiscount in config else null"
          vsoeprice: "float(config[vsoeprice]) if vsoeprice in config else null"
          vsoesopgroup: "str(config[vsoesopgroup]) if vsoesopgroup in config else null"
          hash_id: md5(config['hash_seed'] + str(id) + str(transaction))
          __key_properties__: ["hash_id"]
        transactionaccountingline:
          __source__: transactionline
          # include just the PII and the customer_id
          account: int(expenseaccount)
          accountingbook: int(1)
          amount: float(foreignamount)
          amountlinked: float(fxamountlinked)
          amountpaid: float(foreignamountpaid)
          amountunpaid: float(foreignamountunpaid)
          credit: float(creditforeignamount)
          debit: float(debitforeignamount)
          exchangerate: int(1)
          #glauditnumbersequence: int(glauditnumbersequence)
          #glauditnumbersetby: int(glauditnumbersetby)
          netamount: float(netamount)
          paymentamountunused: float(foreignpaymentamountunused)
          paymentamountused: float(foreignpaymentamountused)
          transaction: int(transaction)
          transactionline: int(id)
          hash_id: md5(config['hash_seed'] + str(id) + str(transaction))
          __key_properties__: ["hash_id"]
          # exclude anything not declared
          __else__: __NULL__
    #     vendor_types:
    #       id: int(id)
    #     vendorcategory:
    #       id: int(id)
    #     vendors:
    #       id: int(id)
      stream_map_config:
          hash_seed: 01AWZh7A6DzGm6iJZZ2T
    # metadata:
    #   account:
    #     replication-method: FULL_TABLE
    #     replication-key: id
    #   customer:
    #     replication-method: INCREMENTAL
    #   "*":
    #     replication-method: INCREMENTAL
    #   "*_full":
    #     replication-method: FULL_TABLE

  loaders:
  - name: target-jsonl
    variant: andyh1203
    pip_url: target-jsonl
  - name: target-postgres
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/target-postgres.git



##################################
#                                #
#       Mappers                  #
#                                #
##################################
  mappers:
  - name: meltano-map-transformer
    pip_url: "git+https://github.com/MeltanoLabs/meltano-map-transform.git"
    executable: meltano-map-transform
    settings:
    - name: stream_maps
      kind: object
    mappings:
    - name: hash_email
      config:
        stream_maps:
          customers:
            id: id
            email:      # drop the PII field from RECORD and SCHEMA messages
            email_domain: email.split('@')[-1]
            email_hash: md5(config['hash_seed'] + email)
            __else__: null
        stream_map_config:
          hash_seed: 01AWZh7A6DzGm6iJZZ2T
    - name: whitelist
      config:
        stream_maps:
          # Whitelist `id` and `description` fields, drop all others
          customers:
            id: id
            description: last_name
            __else__: __NULL__
            __alias__: customers_v2
    - name: add_timestamp
      config:
        stream_maps:
          customers:
            mapping_time: datetime.date.today()
            __alias__: customers_v3
    - name: add_str
      config:
        stream_maps:
          customers:
            client_id: "\"client_123\""
            id: int(id)
            __alias__: customers_v4
            hash_id: md5(str(id))
            __key_properties__: ["hash_id"]
    - name: lower
      config:
        stream_maps:
          customers:
            __alias__: customers_v5
            first_name: first_name.lower() # three different ways of accessing the variable
            last_name: record['last_name'].lower()
            email:  _['email'].upper()
            count_t: str(last_name.count("t")) # need to cast to str because it could be NULL!
            ip_address: __NULL__
    - name: find
      config:
        stream_maps:
          customers:
            __alias__: customers_v6
            first_name: "'found_book' if last_name == 'Book' else 'no_book'"
            id: id
            __else__: __NULL__
    - name: mask
      config:
        stream_maps:
          customers:
            __alias__: customers_v7
            last_name: "config[last_name] if last_name in config else 'no-mask-found'"
            first_name: first_name
            id: id
            __else__: __NULL__
        stream_map_config:
          Book: mask-1
          Tire: mask-2
          Dorian: mask-1
          Suddock: mask-1
          Daws: mask-3
          Maddison: mask-2
          Biernat: mask-4
          Wisden: mask-4
          Loyndon: Mask-2

environments:
  - name: dev
  - name: staging
  - name: prod
